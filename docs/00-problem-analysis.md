# 현재 시스템 문제점 분석

## 1. 현재 시스템 개요

### 1.1 시스템 구성
- **언어**: Python
- **LLM**: QWEN3
- **처리 단위**: 파일 단위 (File-level processing)
- **설계 범위**: 리뷰 정보 수신 후 → LLM 리뷰 → 리뷰 아이템 생성 (I/O 인터페이스 제외)

### 1.2 입력 데이터
| 데이터 | 설명 |
|--------|------|
| PR Description | Pull Request의 설명 텍스트 |
| File Diff | 개별 파일의 변경점 |
| File Name | 변경된 파일명 |
| PR Full Diff | PR 전체의 변경점 (Context 크기에 따라 제외 가능) |
| Function Code | 변경점을 포함하는 함수의 전체 코드 |

### 1.3 현재 처리 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│                    단일 LLM 호출 (파일당 1회)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. PR Description 정제                                         │
│     └─→ 원본 description을 분석 가능한 형태로 변환               │
│                                                                 │
│  2. Description-Change 매칭 분석                                │
│     └─→ PR description의 내용이 현재 파일에 반영되었는지 확인     │
│     └─→ 일치 여부를 JSON으로 출력                                │
│                                                                 │
│  3. 코드 리뷰 수행                                               │
│     ├─→ 3-1. 변경점 해석 (개발자 이해 지원)                      │
│     └─→ 3-2. 문제점 분석 및 개선 코드 제안                       │
│          ├─ 코드 동작 시뮬레이션                                 │
│          ├─ 버그 가능성 탐색                                     │
│          ├─ 문법적 분석                                          │
│          ├─ 동작 문제 분석                                       │
│          └─ 다른 변경점과의 연계 문제 분석                        │
│                                                                 │
│  4. (파일별 분석 후) PR 요약 생성                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 식별된 문제점

### 2.1 단일 호출 과부하 (Single Call Overload)

**문제 설명**:
LLM 호출 횟수를 최소화하기 위해 한 번의 호출에 4가지 이상의 역할을 수행하도록 설계됨.

**영향**:
| 영향 영역 | 상세 |
|-----------|------|
| 프롬프트 복잡도 | 단일 프롬프트가 여러 작업을 지시하여 매우 길고 복잡함 |
| 응답 품질 불안정 | 작업 간 간섭으로 일부 작업의 품질이 저하됨 |
| 디버깅 어려움 | 어느 단계에서 문제가 발생했는지 추적 곤란 |
| 출력 파싱 복잡성 | 혼합된 출력에서 각 결과를 분리해야 함 |

**예시 상황**:
```
프롬프트: "다음 PR description을 정제하고, 변경점과 매칭하여 JSON으로 출력하고,
          코드를 리뷰하여 버그를 찾고, 개선안을 제시하세요"

문제: LLM이 일부 작업을 누락하거나 혼합된 형식으로 응답
```

### 2.2 암묵적 COT (Implicit Chain-of-Thought)

**문제 설명**:
코드 리뷰 시 "시뮬레이션하고 탐색하라"는 지시만 있고, 명시적인 추론 단계가 정의되지 않음.

**영향**:
| 영향 영역 | 상세 |
|-----------|------|
| 추론 품질 | LLM이 자체적으로 추론 경로를 결정하여 일관성 부족 |
| 누락 위험 | 중요한 분석 단계를 건너뛸 가능성 |
| 재현성 | 동일 입력에 대해 다른 분석 결과 도출 가능 |

### 2.3 출력 형식 혼재

**문제 설명**:
여러 유형의 결과(정제된 description, 매칭 JSON, 리뷰 코멘트, 개선 코드)가 단일 응답에 혼합됨.

**영향**:
- 파싱 로직 복잡화
- 출력 형식 오류 시 전체 결과 손실
- 후처리 부담 증가

### 2.4 컨텍스트 경쟁 (Context Competition)

**문제 설명**:
제한된 컨텍스트 윈도우에서 여러 입력(PR description, file diff, function code, full diff, 분석 결과)이 경쟁.

**영향**:
| 상황 | 결과 |
|------|------|
| Full Diff 포함 시 | 다른 중요 정보가 잘림 |
| Full Diff 제외 시 | 파일 간 연계 분석 불가 |
| 분석 결과 포함 시 | 원본 코드 공간 감소 |

---

## 3. 문제별 개선 방향

### 3.1 단일 호출 과부하 → 역할 분리

| 현재 | 개선 방향 |
|------|-----------|
| 1회 호출에 4개 역할 | 역할별 분리된 컴포넌트 |
| 복잡한 단일 프롬프트 | 단순하고 명확한 개별 프롬프트 |
| 혼합된 출력 | 역할별 구조화된 출력 |

**고려사항**:
- 호출 횟수 증가에 따른 비용/시간 트레이드오프
- 병렬 처리 가능한 작업 식별
- 의존 관계가 있는 작업의 순차 처리

### 3.2 암묵적 COT → 명시적 추론 단계

| 현재 | 개선 방향 |
|------|-----------|
| "시뮬레이션하라" | 구체적인 시뮬레이션 단계 정의 |
| "버그를 찾아라" | 체크리스트 기반 버그 탐색 |
| 암묵적 추론 | 명시적 추론 출력 요구 |

### 3.3 출력 형식 혼재 → 구조화된 스키마

| 현재 | 개선 방향 |
|------|-----------|
| 자유 형식 텍스트 + JSON 혼합 | JSON Schema 기반 구조화 |
| 파싱 로직 분산 | 통일된 출력 파서 |

### 3.4 컨텍스트 경쟁 → 계층적 처리

| 현재 | 개선 방향 |
|------|-----------|
| 모든 정보를 한 번에 전달 | 단계별 필요 정보만 전달 |
| Full Diff 전체 포함 시도 | 요약 또는 관련 부분만 추출 |

---

## 4. 제약 조건

개선 설계 시 고려해야 할 제약:

| 제약 | 상세 |
|------|------|
| LLM 비용 | 호출 횟수 증가에 따른 비용 상승 |
| 응답 시간 | 순차 호출 시 전체 처리 시간 증가 |
| 기존 시스템 호환성 | 입출력 인터페이스 유지 필요 |
| QWEN3 특성 | 모델의 강점/약점 고려 |

---

## 5. 다음 단계

→ [04-task-workflow-design.md](04-task-workflow-design.md): Task 및 Workflow 설계 (핵심 문서)
